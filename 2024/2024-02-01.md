## 인덱스 템플릿
인덱스 템플릿은 주로 설정이 동일한 복수의 인덱스를 만들 때 사용한다. 관리 편의성, 성능 등을 위해 인덱스를 파티셔닝하는 일이 많은데 이때 파티셔닝되는 인덱스들은 설정이 같아야 한다. 설정이 동일한 인덱스를 매번 일일이 작성하는 것은 비효율적일 뿐만 아니라 실수를 유발할 수 있다.

### 템플릿 확인
템플릿 API를 사용해 현재 등록된 인덱스 템플릿을 확인할 수 있다. 다음 API는 전체 인덱스 템플릿을 검색한다. 특정 인덱스 템플릿만 확인할 수도 있다. \_index_template 뒤에 템플릿 이름을 적거나 와일드카드 표현식을 이용해 특정 인덱스 템플릿을 확인할 수 있다.

```json
GET _index_template/ilm-history
GET _index_template/ilm*
```

### 템플릿 설정
인덱스 템플릿을 생성할 때 다양한 설정을 할 수 있지만, 일반적으로 매핑과 세팅 설정을 가장 많이 한다. 인덱스 템플릿 기술을 이용해 인덱스 매핑과 세팅을 효율적으로 설정할 수 있다.
#### 템플릿 생성

```json
PUT _index_template/test_template
{
	"index_patterns": ["test_*"],
  	"priority": 1,
  	"template": {
    	"settings": {
        	"number_of_shards": 3,
          	"number_of_replicas": 1
        },
      "mappings":{
      	"properties": {
        	"name": {"type": "text"},
        	"age": {"type": "short"},
        	"gender": {"type": "keyword"}
        }
      }
    }
}
```

text_template이라는 이름의 템플릿을 생성한다.
> 인덱스가 아님에 주의한다.

템플릿 파라미터는 다음과 같다.

|파라미터|설명|
|:---|:---|
|index_patterns|만들어지는 인덱스 중에 인덱스 이름이 인덱스 패턴과 매칭되는 경우 이 템플릿이 적용된다. 여기서는 test_로 시작되는 이름을 가진 인덱스들은 모두 test_template에 있는 매핑, 세팅 등이 적용된다.|
|priority| 인덱스 생성 시 이름에 매칭되는 템플릿이 둘 이상일 때 템플릿이 적용되는 우선순위를 정할 수 있다. 숫자가 가장 높은 템플릿이 먼저 적용된다.|
|template|새로 생성되는 인덱스에 적용되는 settings, mappings 같은 인덱스 설정을 정의한다.|


#### 템플릿 적용
test_template 템플릿이 적용될 수 있도록 인덱스 패턴에 맞는 인덱스를 만들자. 템플릿을 적용할 때 기억해야 하는 것이 하나 있다. **템플릿을 만들기 전에 이미 존재하던 인덱스는 비록 템플릿 패턴과 일치하더라도 템플릿이 적용되지 않는다.** 즉 test_template을 만들기 전부터 존재했던 인덱스들은 템플릿의 영향을 받지 않는다. 오직 템플릿을 만든 이후에 새로 만들어지는 인덱스들만 템플릿의 영향을 받는다.

템플릿 패턴에 맞는 인덱스를 하나 만들면 다음과 같다.

```json
PUT test_index1/_doc/1
{
	"name": "kim",
	"age": 10,
  	"gender": "male"
}
```

템플릿 적용이 되지 않으면 따로 인덱스 매핑이 없기 때문에 다이나믹 매핑이 적용된다.
#### 템플릿 삭제
템플릿 생성 시 기존 인덱스들이 영향을 받지 않듯이, 템플릿을 지워도 기존 인덱스들은 영향을 받지 않는다. 

```json
DELETE _index_template/test_template
```

DELETE 메소드를 이용해 템플릿만 지원진다.

### 템플릿 우선순위
인덱스 템플릿 파라미터 중 priority를 이용해 복수의 템플릿이 매칭될 경우 우선순위로 정해진다.
### 다이내믹 템플릿
다이내믹 템플릿은 매핑을 다이내믹하게 지정하는 템플릿 기술이다. 왜 필요할까? 매핑은 인덱스 내부의 데이터 저장과 검색 등의 기초가 되기 때문에 매핑은 신중하게 진행되어야 한다. 하지만 **로그 시스템이나 비정형화된 데이터를 인덱싱하는 경우에는 수조를 알지 못하기 때문에 필드 타입을 정확히 정의하기 힘들고, 필드 개수를 정할 수 없는 경우도 있다.** 다이내믹 템플릿은 이처럼 매핑을 정확하게 정할 수 없거나 대략적인 데이터 구조만 알고 있을 때 사용할 수 있는 방법이다.

생성은 dynamic_templates 필드를 통해 생성할 수 있다.

```json
PUT dynamic_index1
{
	"mappings": {
    	"dynamic_templates":[
          {
          	"my_string_fields":{
            	"match_mapping_type": "string",
              	"mapping": {"type": "keyword"}
            }
          }
        ]
    }
}
```

dynamic_index1 인덱스는 다이내믹 템플릿을 사용한다. my_string_fields는 임의로 정의한 다이내믹 템플릿의 이름이다. match_mapping_type은 조건문 혹은 매핑 트리거이다. 조건에 만족할 경우 트리거된다. 매핑은 실제 매핑을 적용하는 부분이다.

