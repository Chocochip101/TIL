TCP의 3-way-handshake와 4-way-handshake
Q. TCP의 연결 설정 과정(3단계)과 연결 종료 과정(4단계)이 단계가 차이나는 이유?
Q. 만약 Server에서 FIN 플래그를 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN 패킷보다 늦게 도착하는 상황이 발생하면 어떻게 될까?
Q. 초기 Sequence Number인 ISN을 0부터 시작하지 않고 난수를 생성해서 설정하는 이유?

TCP의 3-way-handshake와 4-way-handshake는 연결 설정 및 종료 과정에서 각각 다른 단계를 가지는 이유는 TCP의 디자인 및 동작 원리에 기인합니다.

1. TCP의 3-way-handshake (연결 설정 과정)
   - 클라이언트가 서버에 연결을 요청하는 단계입니다.
   - 클라이언트는 SYN(동기화) 패킷을 보내고, 서버는 SYN-ACK(동기화-승인) 패킷을 보내고 요청을 수락합니다.
   - 마지막으로 클라이언트는 ACK(승인) 패킷을 보내고, 이로써 연결이 설정됩니다.
   - 이 과정에서 클라이언트와 서버는 각각의 초기 순서 번호(Initial Sequence Number, ISN)를 생성하여 패킷에 포함시키게 되는데, 이를 통해 데이터 전송 시 순서 및 중복 여부를 확인할 수 있습니다.

2. TCP의 4-way-handshake (연결 종료 과정)
   - 클라이언트 또는 서버가 연결을 종료하기 위해 요청하는 단계입니다.
   - 한 쪽에서 연결 종료를 요청하는 경우, 해당 쪽은 FIN(연결 종료) 패킷을 보내고, 다른 쪽은 ACK로 응답합니다.
   - 이후 다른 쪽에서도 FIN 패킷을 보내고, 다시 해당 쪽은 ACK로 응답하여 연결이 종료됩니다.
   - 4-way-handshake는 양쪽에서 각각 FIN 패킷을 보내고 ACK로 응답하기 때문에, 연결 종료 과정에서 4단계가 필요합니다. 이는 양쪽에서 연결 종료를 확인하고 마무리하는 과정을 거치기 위함입니다.

만약 Server에서 FIN 플래그를 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인해 FIN 패킷보다 늦게 도착하는 상황이 발생한다면, 서버는 해당 패킷을 받고도 여전히 연결이 열려있는 것으로 인식하게 됩니다. 이 경우 서버는 더 이상 클라이언트로부터 데이터를 받지 않는 상태가 되고, 클라이언트는 서버로부터 받은 ACK를 기다리게 됩니다. 클라이언트는 일정 시간(타임아웃) 동안 ACK를 기다리다가 결국 연결이 닫혀있는 것으로 간주하고 타임아웃 이벤트를 발생시킵니다.

초기 Sequence

 Number(ISN)을 0부터 시작하지 않고 난수를 생성하여 설정하는 이유는 다음과 같습니다:
- 초기 Sequence Number는 패킷들 간의 순서를 식별하기 위한 역할을 합니다. 따라서 예측이 어려운 값을 사용하는 것이 좋습니다.
- 난수를 사용하여 ISN을 설정하면 시스템이 예측하기 어려운 초기 순서 번호를 생성할 수 있으므로, 초기 순서 번호를 추측하여 공격하는 시도를 어렵게 만듭니다.
- 예측 가능한 ISN을 사용하면 시퀀스 번호를 쉽게 추측하여 특정 연결을 공격하는 등의 보안상의 위협이 있을 수 있습니다. 따라서 난수를 사용하여 초기 순서 번호를 설정함으로써 보안을 강화할 수 있습니다.