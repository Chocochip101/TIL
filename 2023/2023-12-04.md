# HTTP

HTTP를 요청하기 위해서는 `메서드` 라는 것이 존재하는데,

| 메서드 | 설명 | 메세지 본문이 있는가? |
| --- | --- | --- |
| GET | 서버에서 어떤 문서를 가져온다 | 없음 |
| HEAD | 서버에서 어떤 문서에 대한 헤더만 가져온다 | 없음 |
| POST | 서버가 처리해야 할 데이터를 보낸다 | 있음 |
| PUT | 서버에 요청 메세지의 본문을 저장한다 | 있음 |
| TRACE | 메세지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다 | 없음 |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다 | 없음 |
| DELETE | 서버에서 문서를 제거한다 | 없음 |

위 메서드중에서 **안전한 메서드**가 있는데.

- GET: 서버에게 리소를 요청하기 위한 메서드
- HEAD: 정확하게 GET처럼 행동하지만, 본문은 없고 헤더만 반환한다

그 외로는

- POST: 클라이언트가 서버에 입력 데이터를 등록하기 위해서 사용한다
- PUT: 클라이언트가 요청의 본문을 들고 수정하는데, 리소스의 모든 데이터를 수정한다.(전체 데이터를 넣는 용도) 전체 데이터를 보내지 않으면, 나머지 필드는 null이 될 수 있으니 주의해야 한다.
    1. 기존에 있던 값과 상관 없이 그냥 이 데이터를 넣어서 변경해줘
    2. 기존에 있던 값에 대해 이런 연산을 진행해서 이 데이터를 통해 데이터를 변경해줘
- PATCH: 클라이언트가 요청의 본문을 들고 수정하는데, 리소스의 일부를 수정한다.
- TRACE: 주로 진단을 위해 사용되며, 요청한 요청이 어떠한 연쇄 요청/응답을 거쳐가는지 알 수 있다
- OPTIONS: 어떤 요청 메서드가 있는지 서버에게 질문하는 용도로 많이 쓴다
- DELETE: 서버에게 요청 URL을 삭제해달라고 하지만, **삭제가 수행되는 것을 보장하지 못한다**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/737ee221-99af-4e32-a245-feb1279aa748/Untitled.png)

- 하나의 요청이 있을 때, 처리 전과 후의 서버의 상태가 동일한 것 - 안전성
- 동일한 내용의 여러 요청이 있을 때, 각 요청을 처리한 서버의 상태가 모두 동일한 것 - 멱등성

# HTTP Method의 멱등성(Idempotence)

- 멱등성 : 같은 연산을 여러번 반복해도 그 결과가 달라지지 않는 성질
- 동일한 요청을 여러 번 보내더라도 그 결과는 첫번째 요청의 결과와 같은 것을 의미
- 멱등성은 서버가 동일한 요청을 몇 번 처리하건 간에, 연산을 처리한 후의 서버의 상태가 항상 동일함을 의미한다. 즉, 요청 내용이 동일할 때, 첫번째 요청을 처리한 후와 백 번째 요청을 처리한 후의 서버의 상태가 동일하다는 것이다.
- 멱등성이 보장되는 메소드 : **`GET`**, **`HEAD`**, **`OPTIONS`**, **`PUT`**, **`DELETE`**
    - **`GET`** : 서버에 존재하는 리소스를 단순히 읽어오기만 하는 메소드이기 때문에 당연히 여러번 수행되어도 결과값은 변하지 않는다. 마찬가지로 **`HEAD`**, **`OPTIONS`** 메소드도 조회에 대한 메소드이기 때문에 멱등하다고 할 수 있다.
        - ex : 내 통장 잔고를 100번 조회해도 잔고는 오르지 않는다.
    - **`PUT`** : 서버에 존재하는 리소스를 요청 내용에 따라 대체하므로, 올바르게 구현되었다면 여러번 수행해도 그 결과는 동일할 것이다.
        - ex : 완전히 동일한 빨간색 티셔츠 100개를 짱구에게 1번 갈아입히나, 100번 갈아입히나 짱구의 룩은 변하지 않는다
    - **`DELETE`** : 데이터의 존재 유뮤에 따라 응답 코드는 다르겠지만, 요청을 처리한 후에 파일이 존재하지 않는 서버의 상태는 동일하므로 올바르게 구현되었다면 멱등성이 보장될 것이다.
        - ex : 동일한 맥주잔에 대해 원샷하는 행위를 100번 했을 때, 원샷을 1번 때린 후의 맥주잔의 상태와 100번 때린 후의 맥주잔의 상태는 동일하다.
- 멱등성이 보장되지 않는 메소드 : **`POST`**, `**PATCH**`
    - **`POST` :** 메소드가 호출될 때 마다 서버에 데이터가 추가되어 상태가 변경되기 때문에 멱등성을 위배한다
    - **`PATCH`** : **`PATCH`** 메소드는 항상 멱등성을 보장한다고 할 수 없다. **`PATCH`** 는 멱등성을 보장하도록 설계할 수 있지만, 멱등성을 보장하지 않도록 설계할 수도 있다. **`PUT`** 은 요청에 대한 리소스를 통째로 바꿔버리기 때문에 멱등성이 보장되지만, **`PATCH`** 는 리소스의 일부에 대하여 변화를 명령할 수 있기 때문이다.
        
        ```jsx
        {
          "operation": "add",
          "age": 10
        }
        ```
        
        위 요청을 **`PATCH`** 메소드로 실어 보낸다면, 해당하는 리소스의 **`age`** 필드는 요청마다 10씩 증가하게 될 것 이다. 따라서 단일 호출에 대한 응답과 다중 호출에 대한 응답에 대한 서버의 상태가 다를 것이고, 곧 이는 멱등하지 않음을 의미한다.
        
- **멱등성 보장의 이점**
    - 시스템의 예상치 못한 동작을 방지하고, 네트워크 통신의 문제로 인한 중복 요청이 발생하는 경우에도 안전성을 보장하는 데 도움이 된다

# **안전한 메소드 (Safe Methods)**

- 서버의 상태를 변경시키지 않는 HTTP 메소드
- **`GET`** , **`OPTIONS`** , **`HEAD`** 와 같이 조회에 사용되는 메소드를 안전하다고 이야기할 수 있다.
- 모든 안전한 메소드는 멱등성을 갖지만, 그 역은 성립하지 않는다.
- **`PUT`** 과 **`DELET`** 메소드는 멱등성을 갖지만, **`PUT`** 은 리소스를 수정하고, **`DELETE`** 는 메소드를 제거하므로 안전한 메소드라고 할 수 없다.
- 멱등성을 갖는 메소드가 서버의 상태를 변경하지 않는다고 오해하면 안된다. 멱등성을 갖는 메소드도 서버의 상태를 변경시킬 수 있다. 멱등성의 핵심은 **"요청에 대한 서버의 상태가 항상 같은가?"** 이다.